# Cambios y Avances - Backend

## üß± Middleware y Estructura
- **authMiddleware**
  - Exclusi√≥n de rutas p√∫blicas con `req.originalUrl.startsWith()`:
    - `/api/auth/sign-in`
    - `/api/auth/sign-up`
    - `/api/auth/send-password-reset-email`
    - `/api/docs`
    - `/api/plan/stripe/webhook`
- **api/index.ts**
  - Middleware ordenado: `cors` ‚Üí `helmet` ‚Üí `bodyParser` ‚Üí `databaseMiddleware` ‚Üí `languageMiddleware` ‚Üí `rateLimiter` ‚Üí `swagger` ‚Üí `authMiddleware` ‚Üí rutas ‚Üí `404 JSON` ‚Üí `errorHandler`.
  - Respuestas JSON estandarizadas.

---

## üîê Endpoints de Autenticaci√≥n

### `POST /auth/sign-in`
- Valida credenciales.
- Si el usuario **no est√° verificado**, lanza `Error400('auth.emailNotVerified')`.
- Reenv√≠a correo de verificaci√≥n si `EmailSender` est√° configurado.
- Devuelve `{ token, user }` al iniciar sesi√≥n correctamente.

### `POST /auth/sign-up`
- Crea usuario nuevo.
- Ejecuta proceso `handleOnboard`.
- Devuelve `{ token, user }` (opcional); frontend **ya no usa el token** para iniciar sesi√≥n autom√°tica.

### `GET /auth/me`
- Retorna datos del usuario autenticado.

### `PUT /auth/profile`
- Actualiza campos del perfil (`firstName`, `lastName`, `phoneNumber`, `timezone`, etc).

### `PUT /auth/change-password`
- Cambia contrase√±a previa validaci√≥n.

### `POST /auth/send-password-reset-email`
- Env√≠a correo de recuperaci√≥n o registra enlace en consola si el correo no est√° configurado.

### `POST /auth/send-email-address-verification-email`
- Env√≠a correo de verificaci√≥n.

---

## üß© Estructura Interna
- **SequelizeRepository**
  - Manejo de transacciones por m√©todo `createTransaction`.
- **ApiResponseHandler**
  - Unificaci√≥n de respuestas de √©xito y error.
- **Error Handling**
  - `auth.userNotFound`, `auth.wrongPassword`, `auth.emailNotVerified` definidos y traducibles.
- **JWT**
  - Firmado con `getConfig().AUTH_JWT_SECRET` y expiraci√≥n definida en `.env`.

---

## ‚öôÔ∏è Variables de Entorno
```env
AUTH_JWT_SECRET=clave_secreta
AUTH_JWT_EXPIRES_IN=1d
DB_DIALECT=postgres
DB_HOST=localhost
DB_PORT=5432
DB_NAME=cguard
DB_USER=user
DB_PASSWORD=pass
